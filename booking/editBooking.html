<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>修改预约</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <link rel="stylesheet" href="../lib/layui-v2.6.3/css/layui.css" media="all">
     
    <style>
        /* 红色星号前缀样式 */
        .required::before {
            content: "*";
            color: #ff0000;
            margin-right: 4px;
            font-weight: bold;                
        }
    </style>
</head>
<body>
    <!-- 网页标题 -->
    <fieldset class="layui-elem-field layui-field-title">
        <legend style="font-weight: bold;">修改预约</legend>
    </fieldset>

    <!-- 表单（添加lay-filter，便于后续操作） -->
    <div class="layui-form" lay-filter="bookingForm">
        <!-- 预约课程名 -->
        <div class="layui-form-item">
            <label class="layui-form-label required">预约课程名</label>
            <div class="layui-input-block">
                <input id="classname" type="text" name="classname" class="layui-input" lay-verify="required"
                    lay-reqtext="预约课程名称不能为空!" placeholder="请输入预约课程名称" value="基础瑜伽课">
            </div>
        </div>

        <!-- 课程讲师 -->
        <div class="layui-form-item">
            <label class="layui-form-label required">课程讲师</label>
            <div class="layui-input-block">
                <input id="teacher" type="text" name="teacher" class="layui-input" lay-verify="required"
                    lay-reqtext="讲师名不能为空!" placeholder="请输入讲师名" value="张三">
            </div>
        </div>

        <!-- 课程类型 -->
        <div class="layui-form-item">
            <label class="layui-form-label required">课程类型</label>
            <div class="layui-input-block">
                <select id="classType" name="classType" lay-verify="required">
                    <option value="">请选择课程类型</option>
                    <option value="1" selected>团课</option>
                    <option value="2">私教课</option>
                    <option value="3">小班课</option>
                </select>
            </div>
        </div>

        <!-- 课程等级 -->
        <div class="layui-form-item">
            <label class="layui-form-label required">课程等级</label>
            <div class="layui-input-block">
                <input type="radio" name="level" value="新手" title="新手" checked>
                <input type="radio" name="level" value="进阶" title="进阶">
                <input type="radio" name="level" value="专业" title="专业">
            </div>
        </div>

        <!-- 预约日期 -->
        <div class="layui-form-item">
            <label class="layui-form-label required">预约日期</label>
            <div class="layui-input-block">
                <input id="bookDate" type="text" name="bookDate" class="layui-input" lay-verify="required"
                    lay-reqtext="预约日期不能为空!" placeholder="请输入预约日期" value="2025-08-14">
            </div>
        </div>

        <!-- 预约时间 -->
        <div class="layui-form-item">
            <label class="layui-form-label required">预约时间</label>
            <div class="layui-input-block">
                <input id="bookTime" type="text" name="bookTime" class="layui-input" lay-verify="required"
                    lay-reqtext="预约时间不能为空!" placeholder="请输入预约时间" value="13:00">
            </div>
        </div>

        <!-- 上课场地（可选） -->
        <div class="layui-form-item">
            <label class="layui-form-label">上课场地</label>
            <div class="layui-input-block">
                <input id="classPlace" type="text" name="classPlace" class="layui-input"
                    placeholder="请输入上课场地（私教课可选）">
            </div>
        </div>

        <!-- 上课时长（可选） -->
        <div class="layui-form-item">
            <label class="layui-form-label">上课时长</label>
            <div class="layui-input-block">
                <input id="classDuration" type="text" name="classDuration" class="layui-input"
                    placeholder="请输入上课时长（私教课可选）">
            </div>
        </div>

        <!-- 预约状态 -->
        <div class="layui-form-item">
           <label class="layui-form-label required">预约状态</label>
           <div class="layui-input-block">
               <input type="checkbox" name="status" lay-skin="switch" lay-filter="switchTest" lay-text="预约|取消" checked>
           </div>
        </div>

        <!-- 备注 -->
        <div class="layui-form-item">
            <label class="layui-form-label">备注</label>
            <div class="layui-input-block">
                <textarea name="remark" class="layui-textarea" placeholder="请输入备注信息"></textarea>
            </div>
        </div>

        <!-- 提交按钮 -->
        <div class="layui-form-item">
            <div class="layui-input-block">
                <button class="layui-btn layui-btn-normal" lay-submit lay-filter="saveBtn">确认预约</button>
            </div>
        </div>
    </div>

    <script src="../lib/layui-v2.6.3/layui.js" charset="utf-8"></script>
    <script>
        layui.use(['form', 'layer'], function() {
            var form = layui.form;
            var layer = layui.layer;
            $ = layui.$;

            // ===================== 核心：全量表单校验函数（提交前统一校验，格式不对阻止提交） =====================
            function validateBookingForm() {
                // 1. 预约课程名校验（2-10位汉字/字母组合）
                var classname = $('#classname').val().trim();
                if (!classname) {
                    layer.msg('预约课程名称不能为空', { icon: 5 });
                    $('#classname').focus();
                    return false;
                }
                if (!/^[\u4e00-\u9fa5a-zA-Z]{2,10}$/.test(classname)) {
                    layer.msg('课程名需为2-10位汉字和字母组合', { icon: 2 });
                    $('#classname').focus();
                    return false;
                }

                // 2. 课程讲师校验（2-10位纯汉字）
                var teacher = $('#teacher').val().trim();
                if (!teacher) {
                    layer.msg('讲师名不能为空', { icon: 5 });
                    $('#teacher').focus();
                    return false;
                }
                if (!/^[\u4e00-\u9fa5]{2,10}$/.test(teacher)) {
                    layer.msg('讲师姓名需为2-10位纯汉字', { icon: 2 });
                    $('#teacher').focus();
                    return false;
                }

                // 3. 课程类型校验（必须选择）
                var classType = $('#classType').val().trim();
                if (!classType) {
                    layer.msg('请选择课程类型', { icon: 5 });
                    $('#classType').focus();
                    return false;
                }

                // 4. 预约日期校验（yyyy-mm-dd格式）
                var bookDate = $('#bookDate').val().trim();
                if (!bookDate) {
                    layer.msg('预约日期不能为空', { icon: 5 });
                    $('#bookDate').focus();
                    return false;
                }
                if (!/^\d{4}-\d{2}-\d{2}$/.test(bookDate)) {
                    layer.msg('日期格式需为yyyy-mm-dd（如：2024-05-20）', { icon: 2 });
                    $('#bookDate').focus();
                    return false;
                }

                // 5. 预约时间校验（hh:mm格式，00:00-23:59）
                var bookTime = $('#bookTime').val().trim();
                if (!bookTime) {
                    layer.msg('预约时间不能为空', { icon: 5 });
                    $('#bookTime').focus();
                    return false;
                }
                if (!/^([01][0-9]|2[0-3]):[0-5][0-9]$/.test(bookTime)) {
                    layer.msg('时间格式需为hh:mm（如：19:30，00:00-23:59）', { icon: 2 });
                    $('#bookTime').focus();
                    return false;
                }

                // 6. 上课时长校验（可选，但填写需符合“数字+分钟”格式）
                var classDuration = $('#classDuration').val().trim();
                if (classDuration && !/^\d+分钟$/.test(classDuration)) {
                    layer.msg('上课时长格式需为“数字+分钟”（如：60分钟）', { icon: 2 });
                    $('#classDuration').focus();
                    return false;
                }

                // 所有校验通过
                return true;
            }

            // ===================== 字段失焦校验（即时提示用户，与参考页面逻辑一致） =====================
            // 1. 预约课程名失焦校验
            $("#classname").blur(function() {
                var classname = $(this).val().trim();
                if (!classname) {
                    layer.msg('预约课程名称不能为空', { icon: 5 });
                } else if (!/^[\u4e00-\u9fa5a-zA-Z]{2,10}$/.test(classname)) {
                    layer.msg('课程名需为2-10位汉字和字母组合', { icon: 2 });
                }
            });

            // 2. 课程讲师失焦校验
            $("#teacher").blur(function() {
                var teacher = $(this).val().trim();
                if (!teacher) {
                    layer.msg('讲师名不能为空', { icon: 5 });
                } else if (!/^[\u4e00-\u9fa5]{2,10}$/.test(teacher)) {
                    layer.msg('讲师姓名需为2-10位汉字', { icon: 2 });
                }
            });

            // 3. 课程类型失焦校验
            $("#classType").blur(function() {
                var classType = $(this).val().trim();
                if (!classType) {
                    layer.msg('请选择课程类型', { icon: 5 });
                }
            });

            // 4. 预约日期失焦校验
            $("#bookDate").blur(function() {
                var bookDate = $(this).val().trim();
                if (!bookDate) {
                    layer.msg('预约日期不能为空', { icon: 5 });
                } else if (!/^\d{4}-\d{2}-\d{2}$/.test(bookDate)) {
                    layer.msg('日期格式需为yyyy-mm-dd', { icon: 2 });
                }
            });

            // 5. 预约时间失焦校验
            $("#bookTime").blur(function() {
                var bookTime = $(this).val().trim();
                if (!bookTime) {
                    layer.msg('预约时间不能为空', { icon: 5 });
                } else if (!/^([01][0-9]|2[0-3]):[0-5][0-9]$/.test(bookTime)) {
                    layer.msg('时间格式需为hh:mm', { icon: 2 });
                }
            });

            // 6. 上课时长失焦校验（可选字段）
            $("#classDuration").blur(function() {
                var classDuration = $(this).val().trim();
                if (classDuration && !/^\d+$/.test(classDuration)) {
                    layer.msg('上课时长格式需为数字', { icon: 2 });
                }
            });

            // ===================== 表单提交事件（仅保留一个，避免冲突） =====================
            form.on('submit(saveBtn)', function(data) {
                // 提交前先执行全量校验，格式错误则阻止提交
                if (!validateBookingForm()) {
                    return false;
                }

                // 校验通过，弹出最终提交信息（格式化JSON，便于查看）
                var index = layer.alert(JSON.stringify(data.field, null, 2), {
                    title: '预约信息提交成功',
                    area: ['600px', '500px'], // 适配多字段显示
                    icon: 1 // 成功图标，提升体验
                }, function() {
                    // 关闭弹窗后，关闭iframe并刷新父页面（嵌入场景）
                    layer.close(index);
                    var iframeIndex = parent.layer.getFrameIndex(window.name);
                    parent.layer.close(iframeIndex);
                    parent.location.reload();
                });

                return false; // 阻止表单默认跳转
            });

            // 渲染表单组件（确保下拉框、开关等样式正常）
            form.render();
        });
    </script>
</body>
</html>