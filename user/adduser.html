<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>添加用户</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <link rel="stylesheet" href="../lib/layui-v2.6.3/css/layui.css" media="all">
     
    <style>
        /* 红色星号前缀样式 */
        .required::before {
            content: "*";
            color: #ff0000;
            margin-right: 4px;
            font-weight: bold;                
        }
    </style>
</head>
<body>
    <!-- 网页标题 -->
    <fieldset class="layui-elem-field layui-field-title">
        <legend style="font-weight: bold;">添加用户</legend>
    </fieldset>

    <div class="layui-form" lay-filter="userForm">
        <div class="layui-form-item">
            <label class="layui-form-label required">用户名</label>
            <div class="layui-input-block">
                <input id="username" type="text" name="username" class="layui-input" lay-verify="required"
                    lay-reqtext="用户名不能为空!" placeholder="请输入用户名">
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label required">密码</label>
            <div class="layui-input-block">
                <input id="password" type="password" name="password" class="layui-input" lay-verify="required"
                    lay-reqtext="密码不能为空" placeholder="请输入密码">
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label required">真实姓名</label>
            <div class="layui-input-block">
                <input id="realname" type="text" name="realname" class="layui-input" lay-verify="required"
                    lay-reqtext="真实姓名不能为空" placeholder="请输入真实姓名">
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label required">身份证号</label>
            <div class="layui-input-block">
                <input id="userid" type="text" name="userid" class="layui-input" lay-verify="required"
                    lay-reqtext="身份证号不能为空!" placeholder="请输入身份证号">
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label required">角色</label>
            <div class="layui-input-block">
                <select name="role" lay-verify="required"> <!-- 新增name="role" -->
                    <option value="1">普通用户</option>
                    <option value="2">管理员</option>
                    <option value="3">超级管理员</option>
                </select>
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label required">性别</label>
            <div class="layui-input-block">
                <input type="radio" name="sex" value="男" title="男" checked>
                <input type="radio" name="sex" value="女" title="女">
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label required">手机号</label>
            <div class="layui-input-block">
                <input type="text" id="phone" name="phone" lay-verify="required" lay-reqtext="手机号不能为空"
                    placeholder="请输入手机号" value="" class="layui-input">
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label required">QQ</label>
            <div class="layui-input-block">
                <input id="userqq" type="text" name="userqq" class="layui-input" lay-verify="required"
                    lay-reqtext="QQ不能为空" placeholder="请输入QQ">
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">电子邮箱</label>
            <div class="layui-input-block">
                <input id="email" type="email" name="email" class="layui-input" placeholder="请输入电子邮箱">
            </div>
        </div>

        <div class="layui-form-item">
           <label class="layui-form-label">状态</label>
           <div class="layui-input-block">
               <input type="checkbox" name="status" lay-skin="switch" lay-filter="switchTest" lay-text="启用|禁用" checked>
           </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">备注</label>
            <div class="layui-input-block">
                <textarea name="remark" class="layui-textarea" placeholder="请输入备注信息"></textarea>
            </div>
        </div>

        <div class="layui-form-item">
            <div class="layui-input-block">
                <button class="layui-btn layui-btn-normal" lay-submit lay-filter="saveBtn">确认保存</button>
            </div>
        </div>
    </div>

    <script src="../lib/layui-v2.6.3/layui.js" charset="utf-8"></script>
    <script>
        layui.use(['form', 'layer'], function() {
            var form = layui.form;
            var layer = layui.layer;
            $ = layui.$;

            function validateUserForm() {
                var username = $('#username').val().trim();
                if (!username) {
                    layer.msg('用户名不能为空', { icon: 5 });
                    $('#username').focus();
                    return false;
                }
                if (!/^[a-zA-Z0-9_-]{5,16}$/.test(username)) {
                    layer.msg('用户名需为5-16位字母/数字/下划线/减号组合', { icon: 2 });
                    $('#username').focus();
                    return false;
                }

                var password = $('#password').val().trim();
                if (!password) {
                    layer.msg('密码不能为空', { icon: 5 });
                    $('#password').focus();
                    return false;
                }
                if (!/^[a-zA-Z0-9_-]{6,16}$/.test(password)) {
                    layer.msg('密码需为6-16位字母/数字/下划线/减号组合', { icon: 2 });
                    $('#password').focus();
                    return false;
                }

                var realname = $('#realname').val().trim();
                if (!realname) {
                    layer.msg('真实姓名不能为空', { icon: 5 });
                    $('#realname').focus();
                    return false;
                }
                if (!/^[\u4e00-\u9fa5]{2,10}$/.test(realname)) {
                    layer.msg('真实姓名需为2-10位汉字', { icon: 2 });
                    $('#realname').focus();
                    return false;
                }

                var userid = $('#userid').val().trim();
                if (!userid) {
                    layer.msg('身份证号不能为空', { icon: 5 });
                    $('#userid').focus();
                    return false;
                }
                var idReg = /^[1-9]\d{5}(18|19|20)\d{2}((0[1-9])|(1[0-2]))(([0-2][1-9])|10|20|30|31)\d{3}[0-9Xx]$/;
                if (!idReg.test(userid)) {
                    layer.msg('请输入18位有效身份证号（最后一位可含X）', { icon: 2 });
                    $('#userid').focus();
                    return false;
                }

                var phone = $('#phone').val().trim();
                if (!phone) {
                    layer.msg('手机号不能为空', { icon: 5 });
                    $('#phone').focus();
                    return false;
                }
                if (!/^1[3-9]\d{9}$/.test(phone)) {
                    layer.msg('请输入11位有效手机号', { icon: 2 });
                    $('#phone').focus();
                    return false;
                }

                var userqq = $('#userqq').val().trim();
                if (!userqq) {
                    layer.msg('QQ不能为空', { icon: 5 });
                    $('#userqq').focus();
                    return false;
                }
                if (!/^[1-9]\d{4,11}$/.test(userqq)) {
                    layer.msg('请输入有效QQ号', { icon: 2 });
                    $('#userqq').focus();
                    return false;
                }

                var email = $('#email').val().trim();
                if (email && !/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(email)) {
                    layer.msg('请输入有效电子邮箱', { icon: 2 });
                    $('#email').focus();
                    return false;
                }

                // 所有校验通过
                return true;
            }

            $("#username").blur(function() {
                var username = $(this).val().trim();
                if (!username) {
                    layer.msg('用户名不能为空', { icon: 5 });
                } else if (!/^[a-zA-Z0-9_-]{5,16}$/.test(username)) {
                    layer.msg('用户名需为5-16位字母/数字/下划线/减号组合', { icon: 2 });
                }
            });

            $("#password").blur(function() {
                var password = $(this).val().trim();
                if (!password) {
                    layer.msg('密码不能为空', { icon: 5 });
                } else if (!/^[a-zA-Z0-9_-]{6,16}$/.test(password)) {
                    layer.msg('密码需为6-16位字母/数字/下划线/减号组合', { icon: 2 });
                }
            });

            $("#realname").blur(function() {
                var realname = $(this).val().trim();
                if (!realname) {
                    layer.msg('真实姓名不能为空', { icon: 5 });
                } else if (!/^[\u4e00-\u9fa5]{2,10}$/.test(realname)) {
                    layer.msg('真实姓名需为2-10位汉字', { icon: 2 });
                }
            });

            $("#userid").blur(function() {
                var userid = $(this).val().trim();
                if (!userid) {
                    layer.msg('身份证号不能为空', { icon: 5 });
                } else if (!/^[1-9]\d{5}(18|19|20)\d{2}((0[1-9])|(1[0-2]))(([0-2][1-9])|10|20|30|31)\d{3}[0-9Xx]$/.test(userid)) {
                    layer.msg('请输入18位有效身份证号', { icon: 2 });
                }
            });

            $("#phone").blur(function() {
                var phone = $(this).val().trim();
                if (!phone) {
                    layer.msg('手机号不能为空', { icon: 5 });
                } else if (!/^1[3-9]\d{9}$/.test(phone)) {
                    layer.msg('请输入11位有效手机号', { icon: 2 });
                }
            });

            $("#userqq").blur(function() {
                var userqq = $(this).val().trim();
                if (!userqq) {
                    layer.msg('QQ不能为空', { icon: 5 });
                } else if (!/^[1-9]\d{4,11}$/.test(userqq)) {
                    layer.msg('请输入5-12位有效QQ号', { icon: 2 });
                }
            });

            $("#email").blur(function() {
                var email = $(this).val().trim();
                if (email && !/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(email)) {
                    layer.msg('请输入有效电子邮箱', { icon: 2 });
                }
            });

            form.on('submit(saveBtn)', function(data) {
                // 提交前先执行全量校验，格式错误则阻止提交
                if (!validateUserForm()) {
                    return false;
                }

                // 校验通过，弹出最终提交信息（格式化JSON，便于查看）
                var index = layer.alert(JSON.stringify(data.field, null, 2), {
                    title: '用户信息提交成功',
                    area: ['600px', '500px'], // 适配多字段显示
                    icon: 1 // 成功图标，提升体验
                }, function() {
                    // 关闭弹窗后，关闭iframe并刷新父页面（嵌入场景）
                    layer.close(index);
                    var iframeIndex = parent.layer.getFrameIndex(window.name);
                    parent.layer.close(iframeIndex);
                });

                return false; // 阻止表单默认跳转
            });

            // 渲染表单组件（确保下拉框、开关等样式正常）
            form.render();
        });
    </script>
</body>
</html>