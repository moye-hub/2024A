<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>器材信息</title>
		<link rel="stylesheet" href="../lib/layui-v2.6.3/css/layui.css">
		<style>
			.required::before {
				content: "*";
				color: #ff0000;
				margin-right: 4px;
				font-weight: bold;				
			}
		</style>
	</head>
	<body>
		<fieldset class="layui-elem-field layui-field-title">
			<legend style="font-weight: bold;">器材信息</legend>
		</fieldset>
		<div class="layui-form">
			<div class="layui-form-item">
				<label class="layui-form-label required">器材名称</label>
				<div class="layui-input-block">
					<select lay-verify="required" disabled readonly>
						<option value="1">跑步机</option>
						<option value="2" selected>瑜伽球</option>
						<option value="3">动感单车</option>
						<option value="4">哑铃</option>
						<option value="5" disabled>其他器材敬请期待</option>
					</select>
				</div>
			</div>
			
			<div class="layui-form-item">
			    <label class="layui-form-label required">购买日期</label>
			    <div class="layui-input-block" style="width: 1425px;">
			      <input type="text" class="layui-input" id="birthday" placeholder="yyyy-MM-dd" value="2024-07-21" disabled readonly>
			    </div>
			  </div>
			
			<div class="layui-form-item">
				<label class="layui-form-label required">单价</label>
				<div class="layui-input-block">
				<input id="price" type="text" name="price" class="layui-input" lay-verify="required"
					lay-reqtext="单价不能为空!" placeholder="请输入单价" value="100rmb" disabled readonly>
					</div>
			</div>
			
			<div class="layui-form-item">
				<label class="layui-form-label required">使用寿命</label>
				<div class="layui-input-block">
				<input id="year" type="text" name="year" class="layui-input" lay-verify="required"
					lay-reqtext="使用寿命不能为空!" placeholder="请输入使用寿命" value="5年" disabled readonly>
					</div>
			</div>
			
			<div class="layui-form-item">
				<label class="layui-form-label required">放置位置</label>
				<div class="layui-input-block">
				   <input id="place" type="text" name="place" class="layui-input" lay-verify="required"
					lay-reqtext="场地不能为空!" placeholder="请输入放置位置" value="瑜伽室A" disabled readonly>
				</div>
			</div>
			
			<div class="layui-form-item">
			   <label class="layui-form-label required">状态</label>
			   <div class="layui-input-block">
			       <input type="checkbox" name="status" lay-skin="switch" lay-filter="switchTest" lay-text="报废|正常" disabled readonly>
			   </div>
			</div>

			<div class="layui-form-item">
				<label class="layui-form-label required">器材图片:</label><br>
				<div class="layui-input-block">
					<button type="button" class="layui-btn" id="ID-upload-demo-btn" disabled readonly>
					  <i class="layui-icon layui-icon-upload"></i> 单图片上传
					</button>
					<div style="width: 132px;">
					  <div class="layui-upload-list">
					    <img class="layui-upload-img" id="ID-upload-demo-img" style="width: 100%; height: 92px;">
					    <div id="ID-upload-demo-text"></div>
					  </div>
					  <div class="layui-progress layui-progress-big" lay-showPercent="yes" lay-filter="filter-demo">
					    <div class="layui-progress-bar" lay-percent=""></div>
					  </div>
					</div>
				</div>
			</div>

			<hr style="margin: 21px 0;">
			
			<!-- 多图片上传布局修改 -->
			<div class="layui-form-item">
				<label class="layui-form-label">多图片上传</label>
				<div class="layui-input-block">
					<div class="layui-upload">
					  <button type="button" class="layui-btn" id="ID-upload-demo-btn-2"  disabled readonly>
					    <i class="layui-icon layui-icon-upload"></i> 多图片上传
					  </button> 
					  <blockquote class="layui-elem-quote layui-quote-nm" style="margin-top: 11px;">
					    预览图：
					    <div class="layui-upload-list" id="upload-demo-preview"></div>
					 </blockquote>
					</div>
				</div>
			</div>
			
			<div class="layui-form-item">
				<label class="layui-form-label required">操作说明</label>
				<div class="layui-input-block">
					<textarea  id="tip" name="tip" class="layui-textarea" lay-verify="required"
					lay-reqtext="操作说明不能为空!" placeholder="请输入操作说明" disabled readonly></textarea>
				</div>
			</div>
			
		</div>	
		<script src="../lib/layui-v2.6.3/layui.js"></script>
		<script>
		  layui.use(function(){
		    var laydate = layui.laydate;
		    laydate.render({
		      elem: '#birthday' 
		    });
		    laydate.render({
		      elem: '#createDate', 
		      lang: 'cn' 
		    });
			laydate.render({
			    elem: '#ID-laydate-type-month',
			    type: 'month'
			  });
			  
		  });
		</script>
		<script>
			// 初始化日期选择器
			layui.use(function(){
			  var laydate = layui.laydate;
			  // 购买日期选择器
			  laydate.render({
			    elem: '#birthday',
			    format: 'yyyy-MM-dd',
			    required: true
			  });
			});
			
			// 表单验证逻辑
			layui.use(['form', 'layer'], function() {
			  var form = layui.form; 
			  var layer = layui.layer; 
			  $ = layui.$; 
			
			  // 单价验证
			  $("#price").blur(function() {
			    var price = $(this).val().trim();
			    if (!price) {
			      layer.msg('单价不能为空', {icon: 0});
			    } else if (isNaN(price) || parseFloat(price) <= 0) {
			      layer.msg('请输入有效的单价', {icon: 0});
			    }
			  });
			
			  // 放置位置验证
			  $("#place").blur(function() {
			    var place = $(this).val().trim();
			    if (!place) {
			      layer.msg('放置位置不能为空', {icon: 0});
			    }
			  });
			
			$("#year").blur(function() {
			  var year = $(this).val().trim();
			  if (!year) {
			    layer.msg('使用寿命不能为空', {icon: 0});
			  }
			});
			
			  // 操作说明验证
			  $("#tip").blur(function() {
			    var tip = $(this).val().trim();
			    if (!tip) {
			      layer.msg('操作说明不能为空', {icon: 0});
			    } else if (tip.length > 500) {
			      layer.msg('操作说明不能超过500个字符', {icon: 0});
			    }
			  });
			
			  // 购买日期验证
			  $("#birthday").blur(function() {
			    var birthday = $(this).val().trim();
			    if (!birthday) {
			      layer.msg('购买日期不能为空', {icon: 0});
			    }
			  });
			
			  // 表单提交处理
			  form.on('submit(saveBtn)', function(data) {
			    // 验证所有必填项
			    var isValid = true;
			    var errorMsg = '';
			
			    // 验证器材名称
			    if (!data.field['select'] || data.field['select'] === '') {
			      isValid = false;
			      errorMsg = '请选择器材名称';
			    }
			    // 验证购买日期
			    else if (!$("#birthday").val().trim()) {
			      isValid = false;
			      errorMsg = '购买日期不能为空';
			    }
			    // 验证单价
			    else if (!$("#price").val().trim() || isNaN($("#price").val().trim()) || parseFloat($("#price").val().trim()) <= 0) {
			      isValid = false;
			      errorMsg = '请输入有效的单价';
			    }
			    // 验证放置位置
			    else if (!$("#place").val().trim()) {
			      isValid = false;
			      errorMsg = '放置位置不能为空';
			    }
			    // 验证操作说明
			    else if (!$("#tip").val().trim()) {
			      isValid = false;
			      errorMsg = '操作说明不能为空';
			    }
			
			    // 验证单图片上传
			    if ($("#ID-upload-demo-img").attr('src') === '') {
			      isValid = false;
			      errorMsg = '请上传器材图片';
			    }
			
			    // 验证不通过时显示错误信息
			    if (!isValid) {
			      layer.msg(errorMsg, {icon: 0});
			      return false;
			    }
			
			    // 验证通过，显示提交信息
			    var index = layer.alert(JSON.stringify(data.field, null, 2), {
			      title: '最终的提交信息',
			      area: ['500px', '400px']
			    }, function() {
			      layer.close(index);
			      // 关闭当前iframe
			      var iframeIndex = parent.layer.getFrameIndex(window.name);
			      parent.layer.close(iframeIndex);
			      // 可以在这里添加表单提交到服务器的逻辑
			      /*
			      $.ajax({
			        url: '你的提交地址',
			        type: 'post',
			        data: data.field,
			        success: function(res) {
			          layer.msg('提交成功', {icon: 1});
			          setTimeout(function() {
			            parent.layer.close(iframeIndex);
			          }, 1000);
			        },
			        error: function() {
			          layer.msg('提交失败，请重试', {icon: 2});
			        }
			      });
			      */
			    });
			    return false;
			  });
			});
			
			// 图片上传逻辑
			layui.use(function(){
			  var upload = layui.upload;
			  var layer = layui.layer;
			  var element = layui.element;
			  var $ = layui.$;
			
			  // 单图片上传
			  var uploadInst = upload.render({
			    elem: '#ID-upload-demo-btn',
			    url: '', // 实际项目中替换为你的上传接口
			    accept: 'images',
			    acceptMime: 'image/*',
			    exts: 'jpg|jpeg|png|gif',
			    before: function(obj){
			      obj.preview(function(index, file, result){
			        $('#ID-upload-demo-img').attr('src', result); 
			      });
			      element.progress('filter-demo', '0%'); 
			      layer.msg('上传中', {icon: 16, time: 0});
			    },
			    done: function(res){
			      if(res.code > 0){
			        return layer.msg('上传失败');
			      }
			      $('#ID-upload-demo-text').html(''); 
			      layer.msg('上传成功', {icon: 1});
			    },
			    error: function(){
			      var demoText = $('#ID-upload-demo-text');
			      demoText.html('<span style="color: #FF5722;">上传失败</span> <a class="layui-btn layui-btn-xs demo-reload">重试</a>');
			      demoText.find('.demo-reload').on('click', function(){
			        uploadInst.upload();
			      });
			    },
			    progress: function(n, elem, e){
			      element.progress('filter-demo', n + '%'); 
			      if(n == 100){
			        layer.msg('上传完毕', {icon: 1});
			      }
			    }
			  });
			
			  // 多图片上传
			  upload.render({
			    elem: '#ID-upload-demo-btn-2',
			    url: '', // 实际项目中替换为你的上传接口
			    multiple: true,
			    accept: 'images',
			    acceptMime: 'image/*',
			    exts: 'jpg|jpeg|png|gif',
			    before: function(obj){
			      obj.preview(function(index, file, result){
			        $('#upload-demo-preview').append('<img src="'+ result +'" alt="'+ file.name +'" style="width: 90px; height: 90px; margin: 5px;">')
			      });
			    },
			    done: function(res){
			      layer.msg('多图上传成功', {icon: 1});
			    },
			    error: function(){
			      layer.msg('多图上传失败', {icon: 2});
			    }
			  });
			});

		</script>
		<script>
		layui.use(function(){
		  var upload = layui.upload;
		  var layer = layui.layer;
		  var element = layui.element;
		  var $ = layui.$;
		  var uploadInst = upload.render({
		    elem: '#ID-upload-demo-btn',
		    url: '', 
		    before: function(obj){
		      obj.preview(function(index, file, result){
		        $('#ID-upload-demo-img').attr('src', result); 
		      });
		      element.progress('filter-demo', '0%'); 
		      layer.msg('上传中', {icon: 16, time: 0});
		    },
		    done: function(res){
		      if(res.code > 0){
		        return layer.msg('上传失败');
		      }
		      $('#ID-upload-demo-text').html(''); 
		    },
		    error: function(){
		      var demoText = $('#ID-upload-demo-text');
		      demoText.html('<span style="color: #FF5722;">上传失败</span> <a class="layui-btn layui-btn-xs demo-reload">重试</a>');
		      demoText.find('.demo-reload').on('click', function(){
		        uploadInst.upload();
		      });
		    },
		    progress: function(n, elem, e){
		      element.progress('filter-demo', n + '%'); 
		      if(n == 100){
		        layer.msg('上传完毕', {icon: 1});
		      }
		    }
		  });
		  upload.render({
		    elem: '#ID-upload-demo-btn-2',
		    url: '', 
		    multiple: true,
		    before: function(obj){
		      obj.preview(function(index, file, result){
		        $('#upload-demo-preview').append('<img src="'+ result +'" alt="'+ file.name +'" style="width: 90px; height: 90px;">')
		      });
		    },
		    done: function(res){
		      // 上传完毕后续操作可补充
		    }
		  });
		});
		
		</script>
	</body>
</html>